{% extends "master.html" %}
{% load ui %}
{% load help %}
{% load humanize %}

{% block help %}
    {% pagehelp 'facet_search' %}
{% endblock %}

{% block content %}

<form method="GET" action="{{ limit_url }}">

<div class="horizontal-block">
Your query found {{ hits|intcomma }} hit{{ hits|pluralize }}.
{% if pages %}
    Page {{ page|intcomma  }} of {{ pages|intcomma  }}.
    {% if prev_page %}<a href="{{ prev_page}}">Previous</a>{% endif %}
    {% if next_page %}<a href="{{ next_page}}">Next</a>{% endif %}
{% endif %}
<a href="{{ reset_url }}">Reset</a>
{% if debug %}<span title="{{query}}">[raw]</span>{% endif %}
</div>

{% for f,v in hiddenfields %}
<input type="hidden" name="{{ f }}" value="{{ v }}" />
{% endfor %}
<div class="horizontal-block">
    Keywords: <input type="text" name="kw" value="{{ keywords }}"/>
    <input type="submit" value="Go" />
{% for c in criteria %}
  | {{ c.1 }}
  {% if c.2 %}<a href="{{ limit_url }}or={{ c.0 }}" class="icon or-icon" title="Add additional term"><span>(or ...)</span></a>{% endif %}
  <a href="{{ limit_url }}rem={{ c.0 }}" class="icon remove-icon" title="Remove this criteria"><span>(remove)</span></a>  
{% endfor %}
</div>

<div class="facets">
{% for facet in orfacets %}
{% if facet.items %}
    <div class="facet">
        <div class="facet-header">{{ facet.label }}</div>
        <div class="facet-body">
        {% for term,freq in facet.items %}
            <a href="{{ limit_url_orquery }}c={{ orquery }}|{{ term|urlencode }}">{{ term }}</a>{% if freq %}&nbsp;{{ freq|intcomma  }}{% endif %}
        {% endfor %}
        </div>
    </div>
{% endif %}
{% endfor %}
    
{% for facet in facets %}
{% if facet.items %}
    <div class="facet">
        <div class="facet-header">{{ facet.label }}</div>
        <div class="facet-body">
        {% for term,freq in facet.items %}
            <a href="{{ limit_url }}c={{ facet.name }}:{{ term|urlencode }}">{{ term }}</a>{% if freq %}&nbsp;{{ freq|intcomma  }}{% endif %}&nbsp;(<a
               href="{{ limit_url }}c=-{{ facet.name }}:{{ term|urlencode }}">&times;</a>)
        {% endfor %}
        </div>
    </div>
{% endif %}    
{% endfor %}
</div>

{% if records %}
<div class="resultlist">
<input type="submit" name="action" value="Select" />
{% for r in records %}
    {% record r 'selectable' session.selected_records %}
{% endfor %}
</div>
{% endif %}

</form>
{% endblock %}
