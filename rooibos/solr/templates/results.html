{% extends "master.html" %}
{% load ui %}
{% load help %}
{% load humanize %}

{% block help %}
    {% pagehelp 'facet_search' %}
{% endblock %}

{% block javascript %}
{{ block.super }}
<script type="text/javascript">
    function selectAllOnPage() {
        ids = Array();
        $(".record-select").each(function (i) { ids[i] = this.value; }).val(ids);
        recordSelection(ids, true);
    }
    $(document).ready(function() {
        $("#submit_record_selections").replaceWith($("<input type='button' value='Select all on page'>").click(selectAllOnPage));
    });
</script>    
{% endblock %}    
    
{% block content %}

<form method="GET" action="{{ limit_url }}">

<div class="horizontal-block">
Your query found {{ hits|intcomma }} hit{{ hits|pluralize }}.
{% if pages %}
    Page {{ page|intcomma  }} of {{ pages|intcomma  }}.
    {% if prev_page %}<a href="{{ prev_page}}">Previous</a>{% endif %}
    {% if next_page %}<a href="{{ next_page}}">Next</a>{% endif %}
{% endif %}
<a href="{{ reset_url }}">Reset</a>
{% if debug %}<span title="{{query}}">[raw]</span>{% endif %}
<input id="submit_record_selections" type="submit" name="action" value="Select" />
</div>

{% for f,v in hiddenfields %}
<input type="hidden" name="{{ f }}" value="{{ v }}" />
{% endfor %}
<div class="horizontal-block">
    Keywords: <input type="text" name="kw" value="{{ keywords }}"/>
    <input type="submit" value="Go" />
{% for c in criteria %}
  | {{ c.1 }}
  {% if c.2 %}<a href="{{ limit_url }}or={{ c.0|urlencode }}" class="icon or-icon" title="Add additional term"><span>(or ...)</span></a>{% endif %}
  <a href="{{ limit_url }}rem={{ c.0|urlencode }}" class="icon remove-icon" title="Remove this criteria"><span>(remove)</span></a>  
{% endfor %}
</div>

<div class="facets">
{% if orfacet.facets %}
    <div class="facet">
        <div class="facet-header">{{ orfacet.label }}</div>
        <div class="facet-body">
        {% for term,freq,label in orfacet.facets %}
            <a href="{{ limit_url_orquery }}c={{ orquery }}|{{ term|urlencode }}">{{ label|default:term }}</a>{% if freq %}&nbsp;{{ freq|intcomma  }}{% endif %}
        {% endfor %}
        </div>
    </div>
{% endif %}

{% for facet in facets %}
{% if facet.facets %}
    <div class="facet">
        <div class="facet-header">{{ facet.label }}</div>
        <div class="facet-body">
        {% for term,freq,label in facet.facets %}
            <a href="{{ limit_url }}c={{ facet.name }}:{{ term|urlencode }}">{{ label|default:term }}</a>{% if freq %}&nbsp;{{ freq|intcomma  }}{% endif %}&nbsp;(<a
               href="{{ limit_url }}c=-{{ facet.name }}:{{ term|urlencode }}">&times;</a>)
        {% endfor %}
        </div>
    </div>
{% endif %}    
{% endfor %}
</div>

{% if records %}
{% block records %}
{% endblock %}
{% endif %}

</form>
{% endblock %}
